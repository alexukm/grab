<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title>WebSocket STOMP Test</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/sockjs-client/1.5.1/sockjs.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/stomp.js/2.3.3/stomp.min.js"></script>
</head>

<body>
<h1>WebSocket STOMP Test</h1>
<div>
    <label for="message-input">Message:</label>
    <input type="text" id="message-input" placeholder="Enter message">
    <button id="send-button">Send</button>
</div>
<div id="response-log"></div>

<script>
    var authToken = 'Bearer c2bed56d816fe9500391a86212e548c6';
    var socket = new SockJS('http://192.168.49.128:8080/uniEase/ws-sfc');
    var headers = {
        'Authentication': authToken
    };
    var stompClient = Stomp.over(socket);

    stompClient.connect(headers, function (frame) {
        console.log('Connected');
        // Subscribe to the response destination
        stompClient.subscribe('/user/topic/refreshOrder', function (message) {
            console.log('Received: ' + message.body);
            document.getElementById('response-log').textContent += 'Received: ' + message.body + '\n';
        });
        stompClient.subscribe('/topic/refreshOrder', function (message) {
            console.log('Received: ' + message.body);
            document.getElementById('response-log').textContent += 'Received: ' + message.body + '\n';
        });
    }, function (error) {
        console.log('Error: ' + error);
    });

    // "x": -73.95203763706475, "y": 40.79274523698521
    function sendMessage() {
        // var message = document.getElementById('message-input').value;
        var message = "{\n" +
            "            \"page\": 1, \n" +
            "            \"pageSize\": 10,\n" +
            "            \"departureLongitude\": -73.95203763706475,\n" +
            "            \"departureLatitude\": 40.79274523698521\n" +
            "        }"
        stompClient.send('/xfc/v1/ride/query', {'Authorization': authToken},message );
    }

    document.getElementById('send-button').addEventListener('click', sendMessage);
</script>
</body>

</html>
